function getText(e){return e?"string"==typeof e?e.replace(/\n/gm,"").trim():e.content?e.content.replace(/[\s]{3,}/gm,"\n").trim():e[0].content.replace(/[\s]{3,}/gm,"\n").trim():""}module.exports=function(e,t,r){Ti.Yahoo.yql('select * from html where url="'+e+'" and xpath="//table"',function(e){if(e.success&&e.data&&e.data.table&&e.data.table.length>2){var i=e.data.table,a=[];i.forEach(function(e){if("form"!=e["class"]){var t={};e.tbody.tr&&e.tbody.tr instanceof Array&&e.tbody.tr.forEach(function(e){if(e.th&&(t.title=e.th.h1,t.subtitle=e.th.h2),e.td&&"navi"!=e.td["class"])for(var r=0;r<e.td.length;r++)if("right"==e.td[r]["class"])switch(e.td[r].content){case"Autor(en):":t.autor=getText(e.td[r+1].content);break;case"Inhaltsangabe:":t.inhalt=getText(e.td[r+1]);break;case"Produktion:":t.produktion=e.td[r+1];var i=/^[A-Za-z]+/.exec(t.produktion);console.log(i),i&&i instanceof Array&&(t.logo="/images/"+i[i.length-1].toLowerCase()+".png");break;case"Komponist(en):":t.komponisten=getText(e.td[r+1].content);break;case"Regisseur(e):":t.regisseure=getText(e.td[r+1].content);break;case"Ãœbersetzer:":t.uebersetzer=getText(e.td[r+1].content);break;case"Mitwirkende:":t.mitwirkende=require("controls/staff")(e.td[r+1])}}),t.title&&a.push(t)}}),t(a)}else r()})};