!function(){function e(e,t){var a=function(){};a.prototype=t.prototype,e.super_=t,e.prototype=new a,e.prototype.constructor=e}function t(e,t){this._options=t?t:{},this._validateBuilder(e);this._builder=e,this.reset()}function a(e,t){this.reset(),this._options=t?t:{},void 0===this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),void 0===this._options.includeLocation&&(this._options.includeLocation=!1),void 0===this._options.verbose&&(this._options.verbose=!0),void 0===this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),void 0===this._options.caseSensitiveTags&&(this._options.caseSensitiveTags=!1),void 0===this._options.caseSensitiveAttr&&(this._options.caseSensitiveAttr=!1),"function"==typeof e&&(this._callback=e)}function i(e){i.super_.call(this,e,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1,caseSensitiveTags:!0})}var n;if("undefined"!=typeof module&&"undefined"!=typeof module.exports)n=module.exports;else{if(n={},this.Tautologistics||(this.Tautologistics={}),this.Tautologistics.NodeHtmlParser)return;this.Tautologistics.NodeHtmlParser=n}var r={Text:"text",Tag:"tag",Attr:"attr",CData:"cdata",Doctype:"doctype",Comment:"comment"};if("undefined"!=typeof module&&"undefined"!=typeof module.exports){var o=Ti.Stream.createStream({mode:Titanium.Stream.MODE_READ});e(t,o),t.prototype.writable=!0,t.prototype.write=function(e){e instanceof Buffer&&(e=e.toString()),this.parseChunk(e)},t.prototype.end=function(e){arguments.length&&this.write(e),this.writable=!1,this.done()},t.prototype.destroy=function(){this.writable=!1}}t.prototype.reset=function(){this._state={mode:r.Text,pos:0,data:null,pendingText:null,pendingWrite:null,lastTag:null,isScript:!1,needData:!1,output:[],done:!1},this._builder.reset()},t.prototype.parseChunk=function(e){for(this._state.needData=!1,this._state.data=null!==this._state.data?this._state.data.substr(this.pos)+e:e;this._state.pos<this._state.data.length&&!this._state.needData;)this._parse(this._state)},t.prototype.parseComplete=function(e){this.reset(),this.parseChunk(e),this.done()},t.prototype.done=function(){this._state.done=!0,this._parse(this._state),this._flushWrite(),this._builder.done()},t.prototype._validateBuilder=function(e){if("object"!=typeof e)throw new Error("Builder is not an object");if("function"!=typeof e.reset)throw new Error("Builder method 'reset' is invalid");if("function"!=typeof e.done)throw new Error("Builder method 'done' is invalid");if("function"!=typeof e.write)throw new Error("Builder method 'write' is invalid");if("function"!=typeof e.error)throw new Error("Builder method 'error' is invalid")},t.prototype._parse=function(){switch(this._state.mode){case r.Text:return this._parseText(this._state);case r.Tag:return this._parseTag(this._state);case r.Attr:return this._parseAttr(this._state);case r.CData:return this._parseCData(this._state);case r.Doctype:return this._parseDoctype(this._state);case r.Comment:return this._parseComment(this._state)}},t.prototype._writePending=function(e){this._state.pendingWrite||(this._state.pendingWrite=[]),this._state.pendingWrite.push(e)},t.prototype._flushWrite=function(){if(this._state.pendingWrite){for(var e=0,t=this._state.pendingWrite.length;t>e;e++){var a=this._state.pendingWrite[e];this._builder.write(a)}this._state.pendingWrite=null}},t.prototype._write=function(e){this._flushWrite(),this._builder.write(e)},t._re_parseText_scriptClose=/<\s*\/\s*script/gi,t.prototype._parseText=function(){var e,a=this._state;a.isScript?(t._re_parseText_scriptClose.lastIndex=a.pos,e=t._re_parseText_scriptClose.exec(a.data),e=e?e.index:-1):e=a.data.indexOf("<",a.pos);var i=-1===e?a.data.substring(a.pos,a.data.length):a.data.substring(a.pos,e);if(0>e&&a.done&&(e=a.data.length),0>e){if(a.isScript)return void(a.needData=!0);a.pendingText||(a.pendingText=[]),a.pendingText.push(a.data.substring(a.pos,a.data.length)),a.pos=a.data.length}else a.pendingText?(a.pendingText.push(a.data.substring(a.pos,e)),i=a.pendingText.join(""),a.pendingText=null):i=a.data.substring(a.pos,e),""!==i&&this._write({type:r.Text,data:i}),a.pos=e+1,a.mode=r.Tag},t.re_parseTag=/\s*(\/?)\s*([^\s>\/]+)(\s*)\??(>?)/g,t.prototype._parseTag=function(){var e=this._state;t.re_parseTag.lastIndex=e.pos;var a=t.re_parseTag.exec(e.data);if(a){if(!a[1]&&"!--"===a[2].substr(0,3))return e.mode=r.Comment,void(e.pos+=3);if(!a[1]&&"![CDATA["===a[2].substr(0,8))return e.mode=r.CData,void(e.pos+=8);if(!a[1]&&"!DOCTYPE"===a[2].substr(0,8))return e.mode=r.Doctype,void(e.pos+=8);if(!e.done&&e.pos+a[0].length===e.data.length)return void(e.needData=!0);var i;">"===a[4]?(e.mode=r.Text,i=a[0].substr(0,a[0].length-1)):(e.mode=r.Attr,i=a[0]),e.pos+=a[0].length;var n={type:r.Tag,name:a[1]+a[2],raw:i};e.mode===r.Attr&&(e.lastTag=n),"script"===n.name.toLowerCase()?e.isScript=!0:"/script"===n.name.toLowerCase()&&(e.isScript=!1),e.mode===r.Attr?this._writePending(n):this._write(n)}else e.needData=!0},t.re_parseAttr_findName=/\s*([^=<>\s'"\/]+)\s*/g,t.prototype._parseAttr_findName=function(){t.re_parseAttr_findName.lastIndex=this._state.pos;var e=t.re_parseAttr_findName.exec(this._state.data);return e?this._state.pos+e[0].length!==t.re_parseAttr_findName.lastIndex?null:{match:e[0],name:e[1]}:null},t.re_parseAttr_findValue=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g,t.re_parseAttr_findValue_last=/\s*=\s*['"]?(.*)$/g,t.prototype._parseAttr_findValue=function(){var e=this._state;t.re_parseAttr_findValue.lastIndex=e.pos;var a=t.re_parseAttr_findValue.exec(e.data);return a?e.pos+a[0].length!==t.re_parseAttr_findValue.lastIndex?null:{match:a[0],value:a[1]||a[2]||a[3]}:e.done?(t.re_parseAttr_findValue_last.lastIndex=e.pos,a=t.re_parseAttr_findValue_last.exec(e.data),a?{match:a[0],value:""!==a[1]?a[1]:null}:null):null},t.re_parseAttr_splitValue=/\s*=\s*['"]?/g,t.re_parseAttr_selfClose=/(\s*\/\s*)(>?)/g,t.prototype._parseAttr=function(){var e=this._state,a=this._parseAttr_findName(e);if(a&&"?"!==a.name){if(!e.done&&e.pos+a.match.length===e.data.length)return e.needData=!0,null;e.pos+=a.match.length;var i=this._parseAttr_findValue(e);if(i){if(!e.done&&e.pos+i.match.length===e.data.length)return e.needData=!0,void(e.pos-=a.match.length);e.pos+=i.match.length}else{if(t.re_parseAttr_splitValue.lastIndex=e.pos,t.re_parseAttr_splitValue.exec(e.data))return e.needData=!0,void(e.pos-=a.match.length);i={match:"",value:null}}e.lastTag.raw+=a.match+i.match,this._writePending({type:r.Attr,name:a.name,data:i.value})}else{t.re_parseAttr_selfClose.lastIndex=e.pos;var n=t.re_parseAttr_selfClose.exec(e.data);if(n&&n.index===e.pos){if(!e.done&&!n[2]&&e.pos+n[0].length===e.data.length)return void(e.needData=!0);e.lastTag.raw+=n[1],this._write({type:r.Tag,name:"/"+e.lastTag.name,raw:null}),e.pos+=n[1].length}var o=e.data.indexOf(">",e.pos);if(0>o){if(e.done)return e.lastTag.raw+=e.data.substr(e.pos),void(e.pos=e.data.length);e.needData=!0}else e.pos=o+1,e.mode=r.Text}},t.re_parseCData_findEnding=/\]{1,2}$/,t.prototype._parseCData=function(){var e=this._state,a=e.data.indexOf("]]>",e.pos);if(0>a&&e.done&&(a=e.data.length),0>a){t.re_parseCData_findEnding.lastIndex=e.pos;var i=t.re_parseCData_findEnding.exec(e.data);if(i)return void(e.needData=!0);e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var n;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,a)),n=e.pendingText.join(""),e.pendingText=null):n=e.data.substring(e.pos,a),this._write({type:r.CData,data:n}),e.mode=r.Text,e.pos=a+3}},t.prototype._parseDoctype=function(){var e=this._state,a=e.data.indexOf(">",e.pos);if(0>a&&e.done&&(a=e.data.length),0>a)t.re_parseCData_findEnding.lastIndex=e.pos,e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0;else{var i;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,a)),i=e.pendingText.join(""),e.pendingText=null):i=e.data.substring(e.pos,a),this._write({type:r.Doctype,data:i}),e.mode=r.Text,e.pos=a+1}},t.re_parseComment_findEnding=/\-{1,2}$/,t.prototype._parseComment=function(){var e=this._state,a=e.data.indexOf("-->",e.pos);if(0>a&&e.done&&(a=e.data.length),0>a){t.re_parseComment_findEnding.lastIndex=e.pos;var i=t.re_parseComment_findEnding.exec(e.data);if(i)return void(e.needData=!0);e.pendingText||(e.pendingText=[]),e.pendingText.push(e.data.substr(e.pos,e.data.length)),e.pos=e.data.length,e.needData=!0}else{var n;e.pendingText?(e.pendingText.push(e.data.substring(e.pos,a)),n=e.pendingText.join(""),e.pendingText=null):n=e.data.substring(e.pos,a),this._write({type:r.Comment,data:n}),e.mode=r.Text,e.pos=a+3}},a._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1,"?xml":1},a.reWhitespace=/^\s*$/,a.prototype.dom=null,a.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._lastTag=null,this._tagStack.last=function(){return this.length?this[this.length-1]:null},this._line=1,this._col=1},a.prototype.done=function(){this._done=!0,this.handleCallback(null)},a.prototype.error=function(e){this.handleCallback(e)},a.prototype.handleCallback=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.isEmptyTag=function(e){var t=e.name.toLowerCase();return"?"==t.charAt(0)?!0:("/"==t.charAt(0)&&(t=t.substring(1)),this._options.enforceEmptyTags&&!!a._emptyTags[t])},a.prototype._getLocation=function(){return{line:this._line,col:this._col}},a.prototype._updateLocation=function(e){var t=e.type===r.Tag?e.raw:e.data;if(null!==t){var a=t.split("\n");this._line+=a.length-1,a.length>1&&(this._col=1),this._col+=a[a.length-1].length,e.type===r.Tag?this._col+=2:e.type===r.Comment?this._col+=7:e.type===r.CData&&(this._col+=12)}},a.prototype._copyElement=function(e){var t={type:e.type};if(this._options.verbose&&void 0!==e.raw&&(t.raw=e.raw),void 0!==e.name)switch(e.type){case r.Tag:t.name=this._options.caseSensitiveTags?e.name:e.name.toLowerCase();break;case r.Attr:t.name=this._options.caseSensitiveAttr?e.name:e.name.toLowerCase();break;default:t.name=this._options.caseSensitiveTags?e.name:e.name.toLowerCase()}return void 0!==e.data&&(t.data=e.data),e.location&&(t.location={line:e.location.line,col:e.location.col}),t},a.prototype.write=function(e){if(this._done&&this.handleCallback(new Error("Writing to the builder after done() called is not allowed without a reset()")),this._options.includeLocation&&e.type!==r.Attr&&(e.location=this._getLocation(),this._updateLocation(e)),e.type!==r.Text||!this._options.ignoreWhitespace||!a.reWhitespace.test(e.data)){var t,i;if(this._tagStack.last())if(e.type===r.Tag)if("/"==e.name.charAt(0)){var n=this._options.caseSensitiveTags?e.name.substring(1):e.name.substring(1).toLowerCase();if(!this.isEmptyTag(e)){for(var o=this._tagStack.length-1;o>-1&&this._tagStack[o--].name!=n;);if(o>-1||this._tagStack[0].name==n)for(;o<this._tagStack.length-1;)this._tagStack.pop()}}else t=this._tagStack.last(),e.type===r.Attr?(t.attributes||(t.attributes={}),t.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data):(i=this._copyElement(e),t.children||(t.children=[]),t.children.push(i),this.isEmptyTag(i)||this._tagStack.push(i),e.type===r.Tag&&(this._lastTag=i));else t=this._tagStack.last(),e.type===r.Attr?(t.attributes||(t.attributes={}),t.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data):(t.children||(t.children=[]),t.children.push(this._copyElement(e)));else e.type===r.Tag?"/"!=e.name.charAt(0)&&(i=this._copyElement(e),this.dom.push(i),this.isEmptyTag(i)||this._tagStack.push(i),this._lastTag=i):e.type===r.Attr&&this._lastTag?(this._lastTag.attributes||(this._lastTag.attributes={}),this._lastTag.attributes[this._options.caseSensitiveAttr?e.name:e.name.toLowerCase()]=e.data):this.dom.push(this._copyElement(e))}},a.prototype._options=null,a.prototype._callback=null,a.prototype._done=!1,a.prototype._tagStack=null,e(i,a),i.prototype.done=function(){var e,t={},a=s.getElementsByTagName(function(e){return"rss"==e||"feed"==e},this.dom,!1);if(a.length&&(e=a[0]),e){if("rss"==e.name){t.type="rss",e=e.children[0],t.id="";try{t.title=s.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(n){}try{t.link=s.getElementsByTagName("link",e.children,!1)[0].children[0].data}catch(n){}try{t.description=s.getElementsByTagName("description",e.children,!1)[0].children[0].data}catch(n){}try{t.updated=new Date(s.getElementsByTagName("lastBuildDate",e.children,!1)[0].children[0].data)}catch(n){}try{t.author=s.getElementsByTagName("managingEditor",e.children,!1)[0].children[0].data}catch(n){}t.items=[],s.getElementsByTagName("item",e.children).forEach(function(e){var a={};try{a.id=s.getElementsByTagName("guid",e.children,!1)[0].children[0].data}catch(i){}try{a.title=s.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(i){}try{a.link=s.getElementsByTagName("link",e.children,!1)[0].children[0].data}catch(i){}try{a.description=s.getElementsByTagName("description",e.children,!1)[0].children[0].data}catch(i){}try{a.pubDate=new Date(s.getElementsByTagName("pubDate",e.children,!1)[0].children[0].data)}catch(i){}t.items.push(a)})}else{t.type="atom";try{t.id=s.getElementsByTagName("id",e.children,!1)[0].children[0].data}catch(n){}try{t.title=s.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(n){}try{t.link=s.getElementsByTagName("link",e.children,!1)[0].attributes.href}catch(n){}try{t.description=s.getElementsByTagName("subtitle",e.children,!1)[0].children[0].data}catch(n){}try{t.updated=new Date(s.getElementsByTagName("updated",e.children,!1)[0].children[0].data)}catch(n){}try{t.author=s.getElementsByTagName("email",e.children,!0)[0].children[0].data}catch(n){}t.items=[],s.getElementsByTagName("entry",e.children).forEach(function(e){var a={};try{a.id=s.getElementsByTagName("id",e.children,!1)[0].children[0].data}catch(i){}try{a.title=s.getElementsByTagName("title",e.children,!1)[0].children[0].data}catch(i){}try{a.link=s.getElementsByTagName("link",e.children,!1)[0].attributes.href}catch(i){}try{a.description=s.getElementsByTagName("summary",e.children,!1)[0].children[0].data}catch(i){}try{a.pubDate=new Date(s.getElementsByTagName("updated",e.children,!1)[0].children[0].data)}catch(i){}t.items.push(a)})}this.dom=t}i.super_.prototype.done.call(this)};var s={testElement:function(e,t){if(!t)return!1;for(var a in e)if(e.hasOwnProperty(a))if("tag_name"==a){if(t.type!==r.Tag)return!1;if(!e.tag_name(t.name))return!1}else if("tag_type"==a){if(!e.tag_type(t.type))return!1}else if("tag_contains"==a){if(t.type!==r.Text&&t.type!==r.Comment&&t.type!==r.CData)return!1;if(!e.tag_contains(t.data))return!1}else if(!t.attributes||!e[a](t.attributes[a]))return!1;return!0},getElements:function(e,t,a,i){function n(e){return function(t){return t==e}}if(a=void 0===a||null===a||!!a,i=isNaN(parseInt(i))?-1:parseInt(i),!t)return[];var r,o=[];for(var l in e)"function"!=typeof e[l]&&(e[l]=n(e[l]));if(s.testElement(e,t)&&o.push(t),i>=0&&o.length>=i)return o;if(a&&t.children)r=t.children;else{if(!(t instanceof Array))return o;r=t}for(var d=0;d<r.length&&(o=o.concat(s.getElements(e,r[d],a,i)),!(i>=0&&o.length>=i));d++);return o},getElementById:function(e,t,a){var i=s.getElements({id:e},t,a,1);return i.length?i[0]:null},getElementsByTagName:function(e,t,a,i){return s.getElements({tag_name:e},t,a,i)},getElementsByTagType:function(e,t,a,i){return s.getElements({tag_type:e},t,a,i)}};n.Parser=t,n.HtmlBuilder=a,n.RssBuilder=i,n.ElementType=r,n.DomUtils=s}();