function getText(e){return e?"string"==typeof e?e.replace(/\n/gm,"").trim():e.content?e.content.replace(/[\s]{3,}/gm,"\n").trim():e[0].content.replace(/[\s]{3,}/gm,"\n").trim():""}module.exports=function(e,t,i){Ti.Yahoo.yql('select * from html where url="'+e+'" and xpath="//table"',function(e){if(e.success&&e.data&&e.data.table&&e.data.table.length>2){var r=e.data.table,o=[];r.forEach(function(e){if("form"!=e["class"]){var t={};e.tbody.tr&&e.tbody.tr instanceof Array&&e.tbody.tr.forEach(function(e){if(e.th&&(t.title=e.th.h1,t.subtitle=e.th.h2),e.td&&"navi"!=e.td["class"])for(var i=0;i<e.td.length;i++)if("right"==e.td[i]["class"])switch(e.td[i].content){case"Autor(en):":t.autor=getText(e.td[i+1].content);break;case"Inhaltsangabe:":t.inhalt=getText(e.td[i+1]);break;case"Produktion:":t.produktion=e.td[i+1];var r=/^[A-Za-z]+/.exec(t.produktion);console.log(r),r&&r instanceof Array&&(t.logo="/images/"+r[r.length-1].toLowerCase()+".png");break;case"Komponist(en):":t.komponisten=getText(e.td[i+1].content);break;case"Regisseur(e):":t.regisseure=getText(e.td[i+1].content);break;case"Ãœbersetzer:":t.uebersetzer=getText(e.td[i+1].content);break;case"Mitwirkende:":t.mitwirkende=require("controls/staff")(e.td[i+1])}}),t.title&&o.push(t)}}),t(o)}else i()})};