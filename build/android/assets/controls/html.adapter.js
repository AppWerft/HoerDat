function getText(t){return"string"==typeof t?t.replace(/\n/gm,"").trim():t.content?t.content.replace(/[\s]{3,}/gm,"\n").trim():t[0].content.replace(/[\s]{3,}/gm,"\n").trim()}var Moment=require("vendor/moment");Moment.locale("de"),module.exports=function(t){return Ti.App.Properties.hasProperty(t.date)?void t.onload(JSON.parse(Ti.App.Properties.getString(t.date))):void Ti.Yahoo.yql('select * from html where url="http://s507870211.online.de/index.php?aktion=suche&dat='+t.date+'" and xpath="//table"',function(e){if(e.success&&e.data&&e.data.table&&e.data.table.length>2){var a=e.data.table,r=[];a.forEach(function(t){if("form"!=t.class){var e={};t.tr.forEach(function(t){if(t.th&&(e.title=t.th.h1,e.subtitle=t.th.h2),t.td&&"navi"!=t.td.class)for(var a=0;a<t.td.length;a++)if("right"==t.td[a].class)switch(t.td[a].p){case"Sendetermine:":e.meta=getText(t.td[a+1].p),e.station=e.meta.split(" - ")[0],e.time=e.meta.split(" - ")[1];var r=/^(.*?)\s/.exec(e.meta);if(r&&(e.logo="/images/"+r[1].toLowerCase()+".png"),r=/Länge: (.*?)\)/.exec(e.meta)){var i=r[1],o=i.split(":");o&&(e.duration=60*parseInt(o[0])+parseInt(o[1])),r=/\s(\d\d:\d\d),/.exec(e.meta),r&&(o=e.meta.split(", "),o&&(e.start=Moment(o[1]+o[2],"D. MMM YYYY HH:mm"),e.end=Moment(e.start).add(e.duration,"seconds")))}break;case"Autor(en):":e.autor=getText(t.td[a+1].p);break;case"Inhaltsangabe:":e.inhalt=getText(t.td[a+1].p);break;case"Produktion:":e.produktion=getText(t.td[a+1].p);break;case"Komponist(en):":e.komponisten=getText(t.td[a+1].p);break;case"Regisseur(e):":e.regisseure=getText(t.td[a+1].p);break;case"Übersetzer:":e.uebersetzer=getText(t.td[a+1].p)}}),e.title&&r.push(e)}}),Ti.App.Properties.setString(t.date,JSON.stringify(r)),t.onload(r)}})};