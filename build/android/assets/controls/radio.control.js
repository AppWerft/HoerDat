function LOG(){}function convertToHex(e){for(var t="",n=0;n<e.length;n++)t+=""+e.charCodeAt(n).toString(16);return t}var AudioStreamer=require("vendor/audiostreamer.adapter");const PLAY="/images/play.png",LEER="/images/leer.png",STOP="/images/stop.png";var singleton={cron:null,messageView:null,tick:0,onair:!1,messageView:require("ui/marquee.widget")(),buttonView:null,model:null},$=function(e){singleton.model=e,this.eventhandlers={},singleton.onair=!1,singleton.buttonView=this._buttonView=Ti.UI.createView({bottom:10,width:100,height:100,zIndex:913,backgroundImage:PLAY}),this._buttonView.spinner=require("vendor/circularprogress")({percent:0,size:32,margin:0,touchEnabled:!1,zIndex:91,progressColor:"#427aa7",topper:{color:"transparent",size:32},font:{visible:!1}}),this._buttonView.add(this._buttonView.spinner);var t=this;return this._buttonView.addEventListener("click",function(){if(singleton.onair)return AudioStreamer.stop(),void(singleton.onair=!1);t._buttonView.backgroundImage=LEER,clearInterval(singleton.cron),singleton.tick=0;singleton.model.radiostations[singleton.model.currentstation].logo;t._buttonView.opacity=.2,require("controls/resolveplaylist")({playlist:singleton.model.radiostations[singleton.model.currentstation].playlist,stream:singleton.model.radiostations[singleton.model.currentstation].stream,onload:function(e){singleton.model.radiostations[singleton.model.currentstation].stream=e,t._buttonView.opacity=1,AudioStreamer.play(e,t.callbackFn),t._buttonView.spinner.show(),singleton.tick=0,singleton.cron=setInterval(function(){singleton.tick++,100==singleton.tick&&(clearInterval(singleton.cron),singleton.cron=null,t._buttonView.backgroundImage=PLAY,t._buttonView.spinner.hide({animated:!0})),t._buttonView.spinner.setValue(t.tick/100)},100)},onerror:function(){t._buttonView.opacity=1}})}),this};$.prototype={callbackFn:function(e){switch(e.status){case"PLAYING":if(singleton.onair=!0,singleton.cron&&(console.log("cron wil killed by playing"),clearInterval(singleton.cron),singleton.cron=null),e.message&&singleton.messageView){if(singleton.model.radiostations[singleton.model.currentstation].latin1)t=encodeURI(e.message).replace(/%20/gm," ").replace(/%EF%BF%BD/gm,"Ö").replace("Öchste","ächste").replace("fÖr","für").replace("Öume","äume").replace("esprÖch","espräch").replace("Önster","ünster"),console.log(t);else var t=e.message;singleton.messageView.setText(t)}singleton.buttonView.backgroundImage=STOP,singleton.buttonView.spinner.hide({animated:!0});break;case"STOPPED":singleton.onair=!1,singleton.messageView.setText(""),singleton.buttonView.backgroundImage=PLAY,singleton.buttonView.spinner.hide();break;case"BUFFERING":}},createViews:function(){return[this._buttonView,singleton.messageView]},stopPlayer:function(){AudioStreamer.stop()},hide:function(){var e=this;this._buttonView.animate({duration:100,opacity:0,transform:Ti.UI.create2DMatrix({scale:.3})},function(){e._buttonView.backgroundImage=PLAY})},show:function(){var e=this;this._buttonView.animate({duration:50,opacity:1,transform:Ti.UI.create2DMatrix({scale:1.2})},function(){e._buttonView.animate({duration:50,transform:Ti.UI.create2DMatrix({scale:1})})})},fireEvent:function(e,t){if(this.eventhandlers[e])for(var n=0;n<this.eventhandlers[e].length;n++)this.eventhandlers[e][n].call(this,t)},addEventListener:function(e,t){this.eventhandlers[e]||(this.eventhandlers[e]=[]),this.eventhandlers[e].push(t)},removeEventListener:function(e,t){if(this.eventhandlers[e]){var n=this.eventhandlers[e].filter(function(e){return e!=t});this.eventhandlers[e]=n}}},module.exports=$;